<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flame Fractal Gallery</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #e6e6e6;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.1rem;
            color: #a0a0c0;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .gallery-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            justify-content: center;
            max-width: 1600px;
            margin: 0 auto;
        }

        .fractal-card {
            position: relative;
            width: 200px;
            height: 200px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: #0f0f1f;
        }

        .fractal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.4), 0 0 20px rgba(76, 201, 240, 0.4);
            z-index: 10;
        }

        .fractal-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }

        .fractal-card:hover .fractal-image {
            transform: scale(1.05);
        }

        .tooltip {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 10px;
            font-size: 0.8rem;
            opacity: 0;
            transform: translateY(100%);
            transition: opacity 0.3s ease, transform 0.3s ease;
            overflow-y: auto;
            max-height: 150px;
            z-index: 20;
            border-top: 1px solid #4cc9f0;
        }

        .fractal-card:hover .tooltip {
            opacity: 1;
            transform: translateY(0);
        }

        .fractal-id {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: #4cc9f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            z-index: 5;
        }

        .pagination-controls {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
        }

        button {
            padding: 10px 15px;
            background: #4361ee;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        #pageInfo {
            padding: 10px 15px;
            background: #e6e6e6;
            color: #333;
            border-radius: 4px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #a0a0c0;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Flame Fractal Gallery</h1>
        <p class="subtitle">Explore the intricate patterns of flame fractals. Hover over any image to view the algorithm parameters used to generate it. Each fractal is a unique combination of mathematical functions and transformations creating beautiful, intricate patterns.</p>
        <div id="loadingIndicator" style="display: none; text-align: center; padding: 20px;">
            <p>Loading fractals... <span id="progressCount">0</span>/<span id="totalCount">3204</span></p>
            <div style="width: 100%; max-width: 500px; height: 20px; background: #333; border-radius: 10px; margin: 10px auto; overflow: hidden;">
                <div id="progressBar" style="height: 100%; background: linear-gradient(90deg, #4361ee, #4cc9f0); width: 0%; transition: width 0.3s;"></div>
            </div>
        </div>
    </header>

    <div class="gallery-container" id="gallery">
        <!-- Fractal images will be inserted here by JavaScript -->
    </div>

    <div class="pagination-controls">
        <button id="prevPage" disabled>Previous</button>
        <div id="pageInfo">Page 1 of 65</div>
        <button id="nextPage">Next</button>
    </div>

    <footer>
        <p>Flame Fractal Generator | Rendering Gallery | Created with Python and Chaos Theory | Total: 3204 fractals</p>
        <p style="margin-top: 10px; font-size: 0.9em; color: #a0a0c0;">
            <strong>Note:</strong> For best experience and to see parameters, serve this directory with a local web server.
            Run "python -m http.server 8000" in this directory and open http://localhost:8000/gallery.html in your browser.
        </p>
    </footer>

    <script>
        // This script will dynamically load fractal images and their associated parameters with pagination
        document.addEventListener('DOMContentLoaded', function() {
            // Configuration
            let totalFractals = 3204; // Default fallback value
            const fractalsPerPage = 50; // Number of fractals to show per page
            let currentPage = 1;
            let totalPages = Math.ceil(totalFractals / fractalsPerPage); // Calculate total pages based on total fractals

            // Function to count fractal files by attempting to fetch them sequentially
            async function countTotalFractals() {
                let count = 0;
                // Set a reasonable upper limit to avoid infinite loops
                const maxExpected = 10000; // Upper limit for fractal files
                while (count < maxExpected) {
                    try {
                        const response = await fetch(`fractal_${String(count).padStart(5, '0')}.png`, { method: 'HEAD' });
                        if (response.ok) {
                            count++;
                        } else {
                            break; // Stop when we reach a non-existent file
                        }
                    } catch (error) {
                        // If there's an error fetching, assume we've reached the end
                        break;
                    }
                }
                return count;
            }

            // Update page information display
            function updatePageInfo() {
                totalPages = Math.ceil(totalFractals / fractalsPerPage); // Recalculate total pages based on actual count
                document.getElementById('totalCount').textContent = totalFractals;
                document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;

                // Update footer text that mentions the total
                const footer = document.querySelector('footer p');
                if (footer) {
                    footer.textContent = `Flame Fractal Generator | Rendering Gallery | Created with Python and Chaos Theory | Total: ${totalFractals} fractals`;
                }

                // Also update pagination controls
                updatePaginationControls();
            }

            // Dynamically determine the actual number of fractals
            countTotalFractals().then(actualCount => {
                totalFractals = actualCount > 0 ? actualCount : 3204; // Use actual count or fallback to 3204
                updatePageInfo(); // Update the display with the actual count
            }).catch(error => {
                console.warn('Could not dynamically count fractals, using fallback:', error);
                // Already set to 3204, so continue with that
                updatePageInfo(); // Update display with fallback count
            });

            // Get DOM elements
            const gallery = document.getElementById('gallery');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const progressCount = document.getElementById('progressCount');
            const totalCount = document.getElementById('totalCount');
            const progressBar = document.getElementById('progressBar');
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            const pageInfo = document.getElementById('pageInfo');

            // Function to load parameter JSON for a specific fractal
            async function loadParams(fractalId) {
                try {
                    const response = await fetch(`fractal_${String(fractalId).padStart(5, '0')}_params.json`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.error(`Error loading params for fractal ${fractalId}:`, error.message);
                    return null;
                }
            }

            // Function to generate tooltip content from parameters
            function generateTooltip(params, id) {
                if (!params) {
                    return `<h3>Fractal ${id}</h3><p>Parameters not found</p>`;
                }

                let content = `<h3>Fractal ${id}</h3>`;

                // Handle the actual structure from the JSON files
                if (params.seed) content += `<p><strong>Seed:</strong> ${params.seed.substring(0, 8)}...</p>`;

                if (params.params) {
                    const p = params.params;

                    if (p.num_points) content += `<p><strong>Points:</strong> ${p.num_points.toLocaleString()}</p>`;
                    if (p.gamma) content += `<p><strong>Gamma:</strong> ${p.gamma.toFixed(2)}</p>`;
                    if (p.brightness) content += `<p><strong>Brightness:</strong> ${p.brightness}</p>`;
                    if (p.hue_rotation) content += `<p><strong>Hue Rotation:</strong> ${p.hue_rotation.toFixed(2)}</p>`;
                    if (p.transforms) content += `<p><strong>Transforms:</strong> ${p.transforms.length} functions</p>`;
                } else {
                    content += `<p><strong>Data:</strong> Invalid format</p>`;
                }

                return content;
            }

            // Function to create and append fractal cards for current page
            async function createFractalCards() {
                // Clear current gallery
                gallery.innerHTML = '';

                // Calculate start and end indices for current page
                const startIndex = (currentPage - 1) * fractalsPerPage;
                const endIndex = Math.min(startIndex + fractalsPerPage, totalFractals);

                loadingIndicator.style.display = 'block'; // Show loading indicator
                progressCount.textContent = 0;
                progressBar.style.width = '0%';

                // Process fractals in batches to avoid blocking the UI
                const batchSize = 10; // Process 10 fractals at a time
                for (let batchStart = startIndex; batchStart < endIndex; batchStart += batchSize) {
                    const batchEnd = Math.min(batchStart + batchSize, endIndex);

                    // Process current batch
                    for (let i = batchStart; i < batchEnd; i++) {
                        // Create card element
                        const card = document.createElement('div');
                        card.className = 'fractal-card';

                        // Create fractal ID element
                        const idElement = document.createElement('div');
                        idElement.className = 'fractal-id';
                        idElement.textContent = `#${String(i).padStart(5, '0')}`;
                        card.appendChild(idElement);

                        // Create image element
                        const img = document.createElement('img');
                        img.className = 'fractal-image';
                        img.src = `fractal_${String(i).padStart(5, '0')}.png`;
                        img.alt = `Fractal ${String(i).padStart(5, '0')}`;
                        img.loading = 'lazy'; // Lazy loading for performance

                        // On error, show a placeholder or hide the image
                        img.onerror = function() {
                            this.style.display = 'none';
                            const placeholder = document.createElement('div');
                            placeholder.style.display = 'flex';
                            placeholder.style.alignItems = 'center';
                            placeholder.style.justifyContent = 'center';
                            placeholder.style.height = '100%';
                            placeholder.style.backgroundColor = '#222';
                            placeholder.style.color = '#666';
                            placeholder.textContent = 'Image not available';
                            card.appendChild(placeholder);
                        };

                        card.appendChild(img);

                        // Create tooltip element
                        const tooltip = document.createElement('div');
                        tooltip.className = 'tooltip';
                        tooltip.innerHTML = `<h3>Loading...</h3>`; // Initial loading state
                        card.appendChild(tooltip);

                        // Add the card to the gallery
                        gallery.appendChild(card);

                        // Load parameters and update tooltip
                        try {
                            const params = await loadParams(i);
                            tooltip.innerHTML = generateTooltip(params, String(i).padStart(5, '0'));
                        } catch (error) {
                            console.error(`Failed to load parameters for fractal ${i}:`, error);
                            tooltip.innerHTML = `<h3>Fractal ${String(i).padStart(5, '0')}</h3><p>Parameters not available</p>`;
                        }

                        // Update progress
                        const progress = ((i - startIndex + 1) / fractalsPerPage) * 100;
                        progressCount.textContent = i - startIndex + 1;
                        progressBar.style.width = `${progress}%`;
                    }

                    // Yield control back to browser to prevent UI freezing
                    await new Promise(resolve => setTimeout(resolve, 1));
                }

                // Hide loading indicator when done
                loadingIndicator.style.display = 'none';

                // Update pagination controls
                updatePaginationControls();
            }

            // Function to update pagination controls
            function updatePaginationControls() {
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;
            }

            // Event listeners for pagination buttons
            prevPageBtn.addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    createFractalCards();
                }
            });

            nextPageBtn.addEventListener('click', function() {
                if (currentPage < totalPages) {
                    currentPage++;
                    createFractalCards();
                }
            });

            // Initialize the gallery
            createFractalCards();
        });
    </script>
</body>
</html>